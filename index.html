<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="FlipSide - Premium reselling platform. Shop quality products or become a reseller today and commission on every sale.">
    <meta name="keywords" content="reselling, affiliate, commission, FlipSide, commission rewards">
    <title>FlipSide - Premium Reselling Platform</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://flipside.com/">
    <meta property="og:title" content="FlipSide - Premium Reselling Platform">
    <meta property="og:description"
        content="Join the reselling revolution. Shop premium products or become a reseller and commission on every sale.">
    <meta property="og:image" content="assets/logo.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="FlipSide - Premium Reselling Platform">
    <meta property="twitter:description"
        content="Join the reselling revolution. Shop premium products or become a reseller and commission on every sale.">
    <meta property="twitter:image" content="assets/logo.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;600;700&display=swap"
        rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/favicon.png?v=3">
    <link rel="shortcut icon" type="image/png" href="assets/favicon.png?v=3">

    <!-- Firebase SDK (Added for Reviews & Social Proof) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav>
        <div class="container">
            <div class="nav-container">
                <a href="index.html" class="nav-logo">
                    <img src="assets/logo.png" alt="FlipSide Logo">
                    <span>FlipSide</span>
                </a>

                <ul class="nav-links" id="navLinks">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="reseller.html">Become a Reseller</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="track.html">Orders</a></li>
                </ul>

                <div class="nav-cta">
                    <button class="btn btn-ghost" id="themeToggle" title="Toggle Light/Dark Mode"
                        style="font-size: 1.2rem; padding: 0.5rem;">‚òÄÔ∏è</button>
                    <a href="wishlist.html" class="btn btn-ghost cart-badge" id="wishlistBtn" title="Wishlist">
                        ‚ù§Ô∏è <span>Wishlist</span>
                        <span class="cart-badge-count" id="wishlistCount">0</span>
                    </a>
                    <button class="btn btn-ghost cart-badge" id="cartBtn">
                        üõí <span>Shop</span>
                        <span class="cart-badge-count" id="cartCount">0</span>
                    </button>
                    <a href="admin.html" class="btn btn-outline btn-small">Admin</a>
                </div>

                <button class="menu-toggle" id="menuToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-bg-pattern"></div>
        <div class="hero-content">
            <img src="assets/logo.png" alt="FlipSide Logo" class="hero-logo">
            <h1>Welcome to FlipSide</h1>
            <p>Discover premium products and start commissioning as a reseller. Join our reselling revolution today.</p>
            <div class="hero-cta">
                <a href="products.html" class="btn btn-primary btn-large">Shop Now</a>
                <a href="reseller.html" class="btn btn-secondary btn-large">Become a Reseller</a>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="section">
        <div class="container">
            <div class="section-title">
                <h2>Why Choose FlipSide?</h2>
                <p>The ultimate platform for smart shopping and profitable reselling</p>
            </div>

            <div class="grid grid-3">
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3 class="feature-title">Lightning Fast</h3>
                    <p class="feature-description">Instant digital product delivery and quick processing for physical
                        items. Start selling immediately.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üíé</div>
                    <h3 class="feature-title">Premium Products</h3>
                    <p class="feature-description">Curated selection of high-quality products across electronics,
                        education, and lifestyle categories.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üí∞</div>
                    <h3 class="feature-title">Commission on Sales</h3>
                    <p class="feature-description">Join our reseller program and receive up to 35% commission on every
                        sale
                        through your unique link.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üöÄ</div>
                    <h3 class="feature-title">Easy to Start</h3>
                    <p class="feature-description">Register as a reseller in minutes. Get your unique referral link and
                        start commissioning right away.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3 class="feature-title">Track Everything</h3>
                    <p class="feature-description">Real-time dashboard to monitor your sales, commissions, and
                        performance analytics.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üîí</div>
                    <h3 class="feature-title">Secure Payments</h3>
                    <p class="feature-description">PayPal integration with upcoming support for Bitcoin and other
                        payment methods.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Products Section -->
    <section class="section" style="background: var(--color-bg-darker);">
        <div class="container">
            <div class="section-title">
                <h2>Featured Products</h2>
                <p>Hand-picked premium products with high commission potential</p>
            </div>

            <div class="grid grid-3" id="featuredProducts">
                <!-- Products will be loaded here by JavaScript -->
            </div>

            <div style="text-align: center; margin-top: var(--spacing-xl);">
                <a href="products.html" class="btn btn-primary btn-large">View All Products</a>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">7+</div>
                    <div class="stat-label">Products Available</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value">150+</div>
                    <div class="stat-label">Active Resellers</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value">¬£15K+</div>
                    <div class="stat-label">Commissions Paid</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value">99.8%</div>
                    <div class="stat-label">Satisfaction Rate</div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="section" style="background: var(--color-bg-darker);">
        <div class="container">
            <div class="card card-glass" style="text-align: center; padding: var(--spacing-2xl);">
                <h2 style="margin-bottom: var(--spacing-md);">Ready to Start Commissioning?</h2>
                <p
                    style="font-size: 1.125rem; margin-bottom: var(--spacing-xl); max-width: 600px; margin-left: auto; margin-right: auto;">
                    Join thousands of successful resellers and start receiving commissions on premium products today.
                </p>
                <div style="display: flex; gap: var(--spacing-md); justify-content: center; flex-wrap: wrap;">
                    <a href="reseller.html" class="btn btn-primary btn-large">Become a Reseller</a>
                    <a href="products.html" class="btn btn-outline btn-large">Browse Products</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h3>FlipSide</h3>
                    <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                        Your trusted platform for premium reselling opportunities.
                    </p>
                    <div class="footer-social" id="footerSocial">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="reseller.html">Become a Reseller</a></li>
                        <li><a href="dashboard.html">Dashboard</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="shipping.html">Shipping Info</a></li>
                        <li><a href="returns.html">Returns</a></li>
                        <li><a href="index.html#contact">Contact Us</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>Contact</h3>
                    <ul class="footer-links">
                        <li id="footerEmail">üìß <a
                                href="mailto:muzincorporations@gmail.com">muzincorporations@gmail.com</a></li>
                        <li id="footerPhone" class="hidden">üì± <span></span></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2026 FlipSide. All rights reserved. Built for success.</p>
            </div>
        </div>
    </footer>

    <!-- Product Detail Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal product-detail-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalProductName">Product Details</h3>
                <button class="modal-close" onclick="closeProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="product-detail-grid">
                    <div class="product-detail-gallery">
                        <img src="" alt="" id="modalProductImage" class="product-main-img"
                            onerror="this.src='https://via.placeholder.com/400x400/1a1a1a/FFD700?text=Image+Not+Found'">

                        <div id="modalOtherFavourites" class="other-favourites">
                            <h4 class="other-favourites-title">Other Customer Favourites</h4>
                            <div class="other-favourites-grid" id="favouritesGrid">
                                <!-- Favourites will be loaded here -->
                            </div>
                        </div>
                    </div>
                    <div class="product-detail-info">
                        <div class="product-card-category" id="modalProductCategory">CATEGORY</div>
                        <h2 class="product-info-title" id="modalProductTitle">Product Title</h2>
                        <div class="product-info-price" id="modalProductPrice">¬£0.00</div>

                        <div class="product-info-meta">
                            <span class="badge badge-digital" id="modalProductType">Digital</span>
                            <span class="badge badge-sale" id="modalProductSale" style="display:none">Sale</span>
                        </div>

                        <div class="product-info-desc" id="modalProductDesc">
                            Detailed description goes here...
                        </div>

                        <div class="product-info-actions">
                            <button class="btn btn-primary" id="modalAddToCart">Add to Cart</button>
                            <button class="btn btn-outline" id="modalToggleWishlist">Add to Wishlist</button>
                        </div>

                        <!-- FOMO Dispatch Timer -->
                        <div id="modalFomoTimer" class="fomo-timer">
                            Order within <span class="fomo-timer-clock">...</span> for same-day dispatch!
                        </div>

                        <!-- Share Suite -->
                        <div class="modal-share-suite">
                            <button class="share-btn whatsapp" id="shareWhatsApp">
                                <span>Share on WhatsApp</span>
                            </button>
                            <button class="share-btn x" id="shareTwitter">
                                <span>Share on X</span>
                            </button>
                        </div>

                        <!-- Reviews Section -->
                        <div class="product-reviews-section">
                            <div class="reviews-header">
                                <h3>Customer Reviews</h3>
                                <div id="averageRating" class="star-rating">
                                    <span>Average:</span>
                                    <div class="stars" id="modalAverageStars"></div>
                                </div>
                            </div>

                            <div id="reviewsList">
                                <!-- Reviews dynamically loaded here -->
                            </div>

                            <button class="btn btn-ghost btn-small" onclick="toggleReviewForm()" id="writeReviewBtn">
                                ‚úçÔ∏è Write a Review
                            </button>

                            <div id="reviewFormContainer" class="add-review-form hidden">
                                <h4>Share your experience</h4>
                                <div class="rating-selector">
                                    <span>Rating:</span>
                                    <div id="ratingSelector" class="star-rating interactive">
                                        <span data-value="1" class="star">‚òÖ</span>
                                        <span data-value="2" class="star">‚òÖ</span>
                                        <span data-value="3" class="star">‚òÖ</span>
                                        <span data-value="4" class="star">‚òÖ</span>
                                        <span data-value="5" class="star">‚òÖ</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="text" id="reviewName" class="form-input" placeholder="Your Name">
                                </div>
                                <div class="form-group">
                                    <textarea id="reviewComment" class="form-input" rows="3"
                                        placeholder="What did you think of this product?"></textarea>
                                </div>
                                <button class="btn btn-primary btn-small" onclick="submitReview()">Submit
                                    Review</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/brand-settings.js"></script>
    <script src="js/config.js"></script>
    <script src="js/products.js"></script>
    <script src="js/firebase.js"></script>
    <script>
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');

        menuToggle.addEventListener('click', () => {
            menuToggle.classList.toggle('active');
            navLinks.classList.toggle('active');
        });

        // Load featured products
        function loadFeaturedProducts() {
            const container = document.getElementById('featuredProducts');
            const featured = getFeaturedProducts();

            if (featured.length === 0) {
                container.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--color-text-secondary);">No featured products available.</p>';
                return;
            }

            container.innerHTML = featured.map(product => {
                const price = getFinalPrice(product);
                const isOnSale = product.onSale && product.salePrice;
                const isSaved = isInWishlist(product.id);

                return `
          <div class="product-card" onclick="openProductModal(${product.id})">
            <div class="product-card-image">
              <img src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/400x400/1a1a1a/FFD700?text=${encodeURIComponent(product.name)}'">
              <div class="product-card-badges">
                ${isOnSale ? '<span class="badge badge-sale">Sale</span>' : ''}
              </div>
              <div class="wishlist-btn ${isSaved ? 'active' : ''}" onclick="event.stopPropagation(); toggleWishlist(${product.id})">
                ${isSaved ? '‚ù§Ô∏è' : 'ü§ç'}
              </div>
              <div class="product-commission-badge">
                ${product.commission || CONFIG.defaultCommissionRate}% Commission
              </div>
            </div>
            <div class="product-card-body">
              <div class="product-card-category">${product.category}</div>
              <h3 class="product-card-title">${product.name}</h3>
              <div class="product-card-rating" id="rating-card-${product.id}" style="font-size: 0.75rem; color: var(--color-gold); margin-bottom: 5px;">
                <!-- Rating loaded via JS -->
                ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Verified)
              </div>
              <p class="product-card-description">${product.shortDescription || product.description}</p>
              <div class="product-card-footer">
                <div class="product-price">
                  <div class="product-price-current">¬£${price.toFixed(2)}</div>
                  ${isOnSale ? `<div class="product-price-original">¬£${product.price.toFixed(2)}</div>` : ''}
                </div>
                <button class="btn btn-primary btn-small btn-premium" onclick="event.stopPropagation(); addToCart(${product.id})">Add to Cart</button>
              </div>
            </div>
          </div>
        `;
            }).join('');
        }

        // Update counts
        function updateCounts() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            document.getElementById('cartCount').textContent = cart.length;

            const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            document.getElementById('wishlistCount').textContent = wishlist.length;
        }

        function updateCartCount() { updateCounts(); }

        // Add to cart function
        function addToCart(productId) {
            const product = getProductById(productId);
            if (!product) return;

            const cart = JSON.parse(localStorage.getItem('cart') || '[]');

            // Check if product already in cart
            const existingIndex = cart.findIndex(item => item.id === productId);
            if (existingIndex >= 0) {
                showToast('Product already in cart!', 'error');
                return;
            }

            cart.push({
                id: product.id,
                name: product.name,
                price: getFinalPrice(product),
                image: product.image,
                type: product.type,
                commission: product.commission || CONFIG.defaultCommissionRate
            });

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showToast('Added to cart!', 'success');

            // Cart bounce animation
            const cartIcon = document.getElementById('cartCount');
            if (cartIcon) {
                cartIcon.classList.remove('cart-icon-animate');
                void cartIcon.offsetWidth; // Trigger reflow
                cartIcon.classList.add('cart-icon-animate');
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `<p class="toast-message">${message}</p>`;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Wishlist functions
        function toggleWishlist(productId) {
            let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            const index = wishlist.indexOf(productId);

            if (index > -1) {
                wishlist.splice(index, 1);
                showToast('Removed from wishlist', 'info');
            } else {
                wishlist.push(productId);
                showToast('Added to wishlist!', 'success');
            }

            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            updateCounts();
            loadFeaturedProducts(); // Refresh to update icons
        }

        function isInWishlist(productId) {
            const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            return wishlist.includes(productId);
        }

        // Product Modal functions
        async function openProductModal(productId) {
            const product = getProductById(productId);
            if (!product) return;

            const modal = document.getElementById('productModal');
            const price = getFinalPrice(product);
            const isOnSale = product.onSale && product.salePrice;

            document.getElementById('modalProductImage').src = product.image;
            document.getElementById('modalProductCategory').textContent = product.category;
            document.getElementById('modalProductTitle').textContent = product.name;
            document.getElementById('modalProductPrice').textContent = `¬£${price.toFixed(2)}`;
            document.getElementById('modalProductDesc').innerHTML = product.description.replace(/\n/g, '<br>');
            document.getElementById('modalProductType').textContent = product.type.charAt(0).toUpperCase() + product.type.slice(1);

            const saleBadge = document.getElementById('modalProductSale');
            if (isOnSale) {
                saleBadge.style.display = 'inline-block';
            } else {
                saleBadge.style.display = 'none';
            }

            // Update buttons
            const addBtn = document.getElementById('modalAddToCart');
            addBtn.onclick = () => {
                addToCart(product.id);
                closeProductModal();
            };

            const wishBtn = document.getElementById('modalToggleWishlist');
            const updateWishBtnLabel = () => {
                wishBtn.textContent = isInWishlist(product.id) ? '‚ù§Ô∏è In Wishlist' : 'ü§ç Add to Wishlist';
            };
            updateWishBtnLabel();

            wishBtn.onclick = () => {
                toggleWishlist(product.id);
                updateWishBtnLabel();
            };

            // FOMO Timer
            if (typeof updateDispatchTimer === 'function') {
                updateDispatchTimer('modalFomoTimer');
            }

            // Share Suite
            const shareWhatsApp = document.getElementById('shareWhatsApp');
            const shareTwitter = document.getElementById('shareTwitter');
            if (shareWhatsApp) shareWhatsApp.onclick = () => shareProduct('whatsapp', product.name, product.id);
            if (shareTwitter) shareTwitter.onclick = () => shareProduct('twitter', product.name, product.id);

            // Review Logic
            modal.dataset.productId = productId;
            loadModalReviews(productId);
            resetReviewForm();

            // Load Favourites
            loadFavourites(productId);

            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scroll
        }

        function loadFavourites(currentId) {
            const grid = document.getElementById('favouritesGrid');
            if (!grid) return;

            // allProducts might not be defined on index.html, use getAllProducts()
            const products = typeof getAllProducts === 'function' ? getAllProducts() : [];
            const others = products.filter(p => p.id !== currentId);
            const selected = others.sort(() => 0.5 - Math.random()).slice(0, 2);

            grid.innerHTML = selected.map(p => `
                <div class="fav-item" onclick="event.stopPropagation(); openProductModal(${p.id})">
                    <img src="${p.image}" alt="${p.name}" class="fav-item-img" onerror="this.src='https://via.placeholder.com/100x100/1a1a1a/FFD700?text=Image'">
                    <span class="fav-item-name">${p.name}</span>
                </div>
            `).join('');
        }

        function closeProductModal() {
            const modal = document.getElementById('productModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // --- Review & Rating Logic ---

        function toggleReviewForm() {
            const container = document.getElementById('reviewFormContainer');
            const btn = document.getElementById('writeReviewBtn');
            container.classList.toggle('hidden');
            btn.textContent = container.classList.contains('hidden') ? '‚úçÔ∏è Write a Review' : '‚úñ Cancel Review';
        }

        function resetReviewForm() {
            document.getElementById('reviewFormContainer').classList.add('hidden');
            document.getElementById('writeReviewBtn').textContent = '‚úçÔ∏è Write a Review';
            document.getElementById('reviewName').value = '';
            document.getElementById('reviewComment').value = '';
            const stars = document.querySelectorAll('#ratingSelector .star');
            stars.forEach(s => {
                s.classList.add('empty');
                s.textContent = '‚òÜ';
            });
            window.currentRating = 0;
        }

        // Star Rating Selection
        document.addEventListener('click', (e) => {
            if (e.target.closest('#ratingSelector .star')) {
                const val = parseInt(e.target.dataset.value);
                window.currentRating = val;
                const stars = document.querySelectorAll('#ratingSelector .star');
                stars.forEach(s => {
                    const sVal = parseInt(s.dataset.value);
                    if (sVal <= val) {
                        s.classList.remove('empty');
                        s.textContent = '‚òÖ';
                    } else {
                        s.classList.add('empty');
                        s.textContent = '‚òÜ';
                    }
                });
            }
        });

        async function submitReview() {
            const modal = document.getElementById('productModal');
            const productId = modal.dataset.productId;
            const name = document.getElementById('reviewName').value.trim();
            const comment = document.getElementById('reviewComment').value.trim();
            const rating = window.currentRating || 0;

            if (!name || !comment || rating === 0) {
                showToast('Please fill in all fields and provide a rating.', 'error');
                return;
            }

            const review = {
                productId: productId,
                customerName: name,
                comment: comment,
                rating: rating
            };

            const success = await saveReviewToFirebase(review);
            if (success) {
                showToast('Review submitted! It will appear once approved.', 'success');
                resetReviewForm();
            } else {
                showToast('Failed to submit review.', 'error');
            }
        }

        async function loadModalReviews(productId) {
            const reviewsContainer = document.getElementById('reviewsList');
            const starsContainer = document.getElementById('modalAverageStars');
            reviewsContainer.innerHTML = '<p style="font-size: 0.8rem; color: var(--color-text-muted);">Loading reviews...</p>';

            if (typeof loadReviewsFromFirebase !== 'function') return;

            const reviews = await loadReviewsFromFirebase(productId);

            if (reviews.length === 0) {
                reviewsContainer.innerHTML = '<p style="font-size: 0.8rem; color: var(--color-text-muted); opacity: 0.6;">No reviews yet. Be the first to share your experience!</p>';
                starsContainer.innerHTML = '‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ (0)';
                return;
            }

            // Calculate average
            const avg = reviews.reduce((acc, r) => acc + r.rating, 0) / reviews.length;
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                starsHtml += i <= Math.round(avg) ? '‚òÖ' : '‚òÜ';
            }
            starsContainer.innerHTML = `${starsHtml} (${reviews.length})`;

            // Render reviews
            reviewsContainer.innerHTML = reviews.map(r => `
                <div class="review-card">
                    <div class="review-meta">
                        <span class="review-author">${r.customerName}</span>
                        <div class="star-rating">
                            ${Array(5).fill(0).map((_, i) => i < r.rating ? '‚òÖ' : '‚òÜ').join('')}
                        </div>
                    </div>
                    <div class="review-comment">${r.comment}</div>
                    <div class="review-date" style="font-size: 0.65rem; margin-top: 5px;">${new Date(r.timestamp).toLocaleDateString()}</div>
                </div>
            `).join('');
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const modal = document.getElementById('productModal');
            if (event.target == modal) {
                closeProductModal();
            }
        }

        // Cart button click
        document.getElementById('cartBtn').addEventListener('click', () => {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            if (cart.length === 0) {
                showToast('Your cart is empty', 'error');
            } else {
                window.location.href = 'checkout.html';
            }
        });


        // Load on page ready
        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            renderDynamicInfo();
            loadFeaturedProducts();
            updateCartCount();

            // Check for referral code in URL
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode) {
                localStorage.setItem('referralCode', refCode);
                showToast('Referral code applied!', 'success');
            }
        });
    </script>
    <script src="js/utils.js"></script>
</body>

</html>